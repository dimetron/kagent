apiVersion: kagent.dev/v1alpha2
kind: Agent
metadata:
  name: sre-cluster-diagnostics
  namespace: kagent
spec:
  type: Workflow
  description: "Cluster diagnostic Team with automatic outputKey naming"
  workflow:
    parallel:
      maxWorkers: 5
      timeout: "5m"
      subAgents:
        # Automatic outputKey naming enabled (no explicit outputKey specified)
        # Auto-generated outputKeys follow pattern: {namespace}_{agent_name}
        
        - name: istio-agent
          # Auto-generated outputKey: kagent_istio_agent
          
        - name: helm-agent
          # Auto-generated outputKey: kagent_helm_agent
          
        - name: k8s-agent
          # Auto-generated outputKey: kagent_k8s_agent
          
        # Example with explicit outputKey (overrides automatic naming)
        # - name: prometheus-agent
        #   outputKey: custom_prometheus_key
---
apiVersion: kagent.dev/v1alpha2
kind: Agent
metadata:
  name: sre-report-agent
  namespace: kagent
spec:
  description: SRE Report Agent (aggregates parallel workflow outputs)
  type: Declarative
  declarative:
    modelConfig: default-model-config
    systemMessage: |-
      - You are SRE report agent responsible to build kubernetes cluster health report
      
      ## Data collection
      - Use data prepared by `sre-cluster-diagnostics` workflow
      - Access parallel workflow outputs via auto-generated outputKeys in session.state:
        * kagent_istio_agent: Istio diagnostics
        * kagent_helm_agent: Helm diagnostics
        * kagent_k8s_agent: Kubernetes diagnostics
      
      ## Format
      - Create detailed diagnostic report with separate sections
      - Always add a summary at the end
      - Use emoji and table format

---
apiVersion: kagent.dev/v1alpha2
kind: Agent
metadata:
  name: sre-team
  namespace: kagent
spec:
  type: Workflow
  description: "SRE Team (sequential workflow with automatic outputKey naming)"
  workflow:
    sequential:
      timeout: "5m"
      subAgents:
        # Automatic outputKey naming also works for sequential workflows
        
        - name: sre-coordinator
          # Auto-generated outputKey: kagent_sre_coordinator
          
        - name: sre-cluster-diagnostics
          # Auto-generated outputKey: kagent_sre_cluster_diagnostics
          # This parallel workflow produces kagent_istio_agent, kagent_helm_agent, kagent_k8s_agent
          
        - name: sre-report-agent
          # Auto-generated outputKey: kagent_sre_report_agent
          # This agent aggregates outputs from previous phases
---
apiVersion: kagent.dev/v1alpha2
kind: Agent
metadata:
  name: sre-coordinator
  namespace: kagent
spec:
  description: You are SRE Agent which coordinates Cluster diagnostic Team and
  type: Declarative
  declarative:
    modelConfig: default-model-config
    systemMessage: |-
      - You are autonomous SRE Agent Responsible to plan data collection and of kubernetes cluster health report
      - Build a list of items to check by `sre-cluster-diagnostics` team and delegate report generation to `sre-report-agent`
      - Do not ask user to confirm - act autonomously
      - Use only known available Tools 
      - Do not invent names
---
apiVersion: kagent.dev/v1alpha2
kind: Agent
metadata:
  name: sre-team-manager
  namespace: kagent
spec:
  description: You are SRE Agent which coordinates sre-team tasks
  type: Declarative
  declarative:
    modelConfig: default-model-config
    systemMessage: |-
      - You are autonomous SRE Team Manager which coordinate tasks of SRE team
      - use `sre-team` Agent to perform diagnostic tasks
    tools:
      - type: Agent
        agent:
          name: sre-team